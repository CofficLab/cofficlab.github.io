---
import type { SidebarItem } from '@/models/SidebarItem';
import AppLayout from './AppLayout.astro';
import Sidebar from '../components/sidebar/Sidebar.astro';
import TableOfContents from '../components/toc/TableOfContents.astro';

interface Props {
  title: string;
  description: string;
  sidebarItem: SidebarItem | null;
  headings?: Array<{ depth: number; slug: string; text: string }>;
}

const { title, description, sidebarItem, headings = [] } = Astro.props;

const shouldShowSidebar = sidebarItem
  ? sidebarItem.getItems().length > 0
  : false;
const hasTableOfContents = headings.length > 0;
---

<AppLayout title={title} description={description} isDocContent={true}>
  <div class="flex relative overflow-hidden">
    {/* 侧边栏 */}
    {
      shouldShowSidebar && sidebarItem && (
        <aside class="fixed top-16 left-0 w-64 h-[calc(100vh-4rem)] border-r border-slate-200 dark:border-slate-800 overflow-y-auto">
          <div class="h-full px-4 py-6">
            <Sidebar item={sidebarItem} />
          </div>
        </aside>
      )
    }

    <div
      class:list={[
        'flex-1 min-h-[calc(100vh-4rem)] overflow-hidden',
        shouldShowSidebar ? 'ml-64' : '',
      ]}>
      <div class="container mx-auto px-4 pb-16 overflow-hidden">
        {/* 主内容 */}
        <main class="transition-all duration-300 w-full overflow-hidden">
          <div class="lg:flex justify-center overflow-hidden">
            <div
              class={hasTableOfContents
                ? 'w-full lg:pr-[calc(16rem+1.5rem)] overflow-hidden'
                : 'max-w-4xl mx-auto w-full overflow-hidden'}>
              <div
                transition:animate="fade"
                class="max-w-4xl mx-auto p-4 overflow-hidden">
                <div
                  class="prose prose-slate dark:prose-invert w-full max-w-none overflow-hidden">
                  <slot />
                </div>
              </div>
            </div>
            {
              hasTableOfContents && (
                <aside class="hidden lg:block fixed right-4 top-24 w-64 h-[calc(100vh-8rem)] border-l border-slate-200 dark:border-slate-800 overflow-y-auto">
                  <TableOfContents headings={headings} />
                </aside>
              )
            }
          </div>
        </main>
      </div>
    </div>
  </div>
</AppLayout>
